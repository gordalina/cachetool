<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Cachetool by gordalina</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Cachetool</h1>
        <p>Manage your caches through the cli</p>
        <p class="view"><a href="https://github.com/gordalina/cachetool">View the Project on GitHub <small>gordalina/cachetool</small></a></p>
        <ul>
          <li><a href="https://github.com/gordalina/cachetool/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/gordalina/cachetool/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/gordalina/cachetool">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="cachetool---manage-cache-in-the-cli" class="anchor" href="#cachetool---manage-cache-in-the-cli"><span class="octicon octicon-link"></span></a>CacheTool - Manage cache in the CLI</h1>

<p>CacheTool allows you to work with <code>apc</code> and <code>opcache</code> through the cli.
It will connect to a fastcgi server (like php-fpm) and operate it's cache.</p>

<p>Why is this useful?</p>

<ul>
<li>Maybe you want to clear the bytecode cache without reloading php-fpm or using a web endpoint</li>
<li>Maybe you want to have a cron which deals with cache invalidation</li>
<li>Maybe you want to see some statistics right from the console</li>
<li>And many more...</li>
</ul>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>curl -sO http://gordalina.github.io/cachetool/downloads/cachetool.phar
<span class="nv">$ </span>chmod +x cachetool.phar
</pre></div>

<h2>
<a name="usage-as-an-application" class="anchor" href="#usage-as-an-application"><span class="octicon octicon-link"></span></a>Usage (as an application)</h2>

<p>You can connect to a automatically guessed fastcgi server (if <code>/var/run/php5-fpm.sock</code> is a file or <code>127.0.0.1:9000</code>)</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>php cachetool.phar apc:cache:info --fcgi
</pre></div>

<p>You can connect to a fastcgi server through ip</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>php cachetool.phar apc:cache:info --fcgi<span class="o">=</span>127.0.0.1:9000
</pre></div>

<p>Or by socket</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>php cachetool.phar opcache:status --fcgi<span class="o">=</span>/var/run/php5-fpm.sock
</pre></div>

<p>Or to the cli</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>php cachetool.phar opcache:status --cli
</pre></div>

<p>You have some useful commands that you can you</p>

<div class="highlight highlight-sh"><pre>apc
  apc:bin:dump             Get a binary dump of files and user variables
  apc:bin:load             Load a binary dump into the APC file and user variables
  apc:cache:clear          Clears APC cache <span class="o">(</span>user, system or all<span class="o">)</span>
  apc:cache:info           Shows APC user <span class="p">&amp;</span> system cache information
  apc:cache:info:file      Shows APC file cache information
  apc:key:delete           Deletes an APC key
  apc:key:exists           Checks <span class="k">if</span> an APC key exists
  apc:key:fetch            Shows the content of an APC key
  apc:key:store            Store an APC key with given value
  apc:sma:info             Show APC shared memory allocation information
opcache
  opcache:configuration    Get configuration information about the cache
  opcache:reset            Resets the contents of the opcode cache
  opcache:status           Show summary information about the opcode cache
  opcache:status:scripts   Show scripts in the opcode cache
</pre></div>

<h2>
<a name="configuration-file" class="anchor" href="#configuration-file"><span class="octicon octicon-link"></span></a>Configuration File</h2>

<p>You can have a configuration file with the adapter configuration, allowing you to
call CacheTool withouth <code>--fcgi</code> or <code>--cli</code> option.</p>

<p>The file must be named <code>.cachetool.yml</code>. CacheTool will look for this file on the
current directory and in any parent directory until it finds one.
If the paths above fail it will try to load <code>/etc/cachetool.yml</code> configuration file.</p>

<p>An example of what this file might look like is:</p>

<p>Will connect to fastcgi at 127.0.0.1:9000</p>

<div class="highlight highlight-yml"><pre><span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">fastcgi</span>
<span class="l-Scalar-Plain">fastcgi</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1:9000</span>
</pre></div>

<p>Will connect to cli (disregarding fastcgi configuration)</p>

<div class="highlight highlight-yml"><pre><span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">cli</span>
<span class="l-Scalar-Plain">fastcgi</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/var/run/php5-fpm.sock</span>
</pre></div>

<h2>
<a name="usage-as-a-library" class="anchor" href="#usage-as-a-library"><span class="octicon octicon-link"></span></a>Usage (as a library)</h2>

<p>Add it as a dependency</p>

<div class="highlight highlight-sh"><pre><span class="nv">$ </span>composer require gordalina/cachetool<span class="o">=</span>~1.0
</pre></div>

<p>Create instance</p>

<div class="highlight highlight-php"><pre><span class="k">use</span> <span class="nx">CacheTool\Adapter\FastCGI</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CacheTool\CacheTool</span><span class="p">;</span>

<span class="nv">$adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FastCGI</span><span class="p">(</span><span class="s1">'127.0.0.1:9000'</span><span class="p">);</span>
<span class="nv">$cache</span> <span class="o">=</span> <span class="nx">CacheTool</span><span class="o">::</span><span class="na">factory</span><span class="p">(</span><span class="nv">$adapter</span><span class="p">);</span>
</pre></div>

<p>You can use <code>apc</code> and <code>opcache</code> functions</p>

<div class="highlight highlight-php"><pre><span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">apc_clear_cache</span><span class="p">(</span><span class="s1">'both'</span><span class="p">);</span>
<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">opcache_reset</span><span class="p">();</span>
</pre></div>

<h2>
<a name="proxies" class="anchor" href="#proxies"><span class="octicon octicon-link"></span></a>Proxies</h2>

<p>CacheTool depends on <code>Proxies</code> to provide functionality, by default when creating a CacheTool instance from the factory
all proxies are enabled <a href="https://github.com/gordalina/cachetool/blob/master/src/CacheTool/Proxy/ApcProxy.php"><code>ApcProxy</code></a>, <a href="https://github.com/gordalina/cachetool/blob/master/src/CacheTool/Proxy/OpcacheProxy.php"><code>OpcacheProxy</code></a> and <a href="https://github.com/gordalina/cachetool/blob/master/src/CacheTool/Proxy/PhpProxy.php"><code>PhpProxy</code></a>, you can customize it or extend to your will like the example below:</p>

<div class="highlight highlight-php"><pre><span class="k">use</span> <span class="nx">CacheTool\Adapter\FastCGI</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CacheTool\CacheTool</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">CacheTool\Proxy</span><span class="p">;</span>

<span class="nv">$adapter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FastCGI</span><span class="p">(</span><span class="s1">'/var/run/php5-fpm.sock'</span><span class="p">);</span>
<span class="nv">$cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CacheTool</span><span class="p">();</span>
<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">setAdapter</span><span class="p">(</span><span class="nv">$adapter</span><span class="p">);</span>
<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">addProxy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Proxy\ApcProxy</span><span class="p">());</span>
<span class="nv">$cache</span><span class="o">-&gt;</span><span class="na">addProxy</span><span class="p">(</span><span class="k">new</span> <span class="nx">Proxy\PhpProxy</span><span class="p">());</span>
</pre></div>

<h2>
<a name="updating-cachetool" class="anchor" href="#updating-cachetool"><span class="octicon octicon-link"></span></a>Updating CacheTool</h2>

<p>Running <code>php cachetool.phar self-update</code> will update a phar install with the latest version.</p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<p>PHP 5.3.3</p>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<p>CacheTool is licensed under the MIT License - see the <a href="">LICENSE</a> for details</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/gordalina">gordalina</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-56319856-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>